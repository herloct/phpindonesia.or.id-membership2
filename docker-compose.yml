version: '3'

services:
    composer:
        image: composer:1.4.1
        volumes:
            - .:/app

    codecept:
        image: phpindonesia/membership
        environment:
            DB_HOST: $DB_HOST
            DB_USER: $DB_USER
            DB_PASS: $DB_PASS
            DB_NAME: $DB_NAME
        depends_on:
            - web
        entrypoint:
            - php
            - vendor/bin/codecept
        volumes:
            - .:/app

    web:
        build: .
        image: phpindonesia/membership
        depends_on:
            - database
            - smtp
        expose:
            - '80'
        command:
            - php
            - -S
            - 0.0.0.0:80
            - -t
            - www
        ports:
            - '80:80'
        volumes:
            - .:/app

    database:
        image: mysql:5.6.36
        environment:
            MYSQL_RANDOM_ROOT_PASSWORD: 'yes'
            MYSQL_USER: $DB_USER
            MYSQL_PASSWORD: $DB_PASS
            MYSQL_DATABASE: $DB_NAME

    adminer:
        image: adminer:4.3.0-standalone
        depends_on:
            - database
        ports:
            - '8080:8080'

    smtp:
        image: mailhog/mailhog:v1.0.0
        ports:
            - '8025:8025'
